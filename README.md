# üë®‚Äçüíª üìù ‚ñ∂Ô∏è My common tasks automated in ansible scripts
## Overview
This repo just contains automated tasks in ansible scripts that I use mostly.

## Usage
In most cases you just have to execute playbook:
```shell
ansible-playbook -i <inventory_file> <playbook-file>
```

## `aws_ec2_ubuntu`
1. Creates EC2 instance using public ssh key at `~/.ssh/id_rsa.pub` with Terraform
2. Installs `docker` and `youtube-dl` in Ansible
3. Execution sequence:
   1. `terraform [apply | destroy] -var-file vars.tfvars` (in var file specify your EC2 region)
   2. `ansible-playbook -i .ec2_hosts_<tf workspace name> main-playbook.yml` (here `.ec2_hosts` contains EC2 IP and is generated by Terraform)
   3. To run multiple instances use `terraform workspace` to seperate states:
      1. `terraform workspace new <name>`
      2. Other workspace commands
         1. `terraform workspace list` -- list existing workspaces
         2. `terraform workspace delete <name>` -- delete workspace
4. After you can ssh to host: `ssh ubuntu@<PUBLIC_IP>`
5. Limitation:
   1. each provisioning creates new VPC, so it is limited to 4 by AWS.

## `docker_install`
Installs `docker` to Ubuntu system.

## `k8s_metallb`
Installs K8s with MetalLB load balancer. Executing playbook consists from 2 steps:
1. installing to master node
2. installing to slave nodes

Before execuing first update `hosts` file with host IP addresses. To install:
1. `ansible-playbook -i hosts master-playbook.yml`
2. `ansible-playbook -i hosts node-playbook.yml`
